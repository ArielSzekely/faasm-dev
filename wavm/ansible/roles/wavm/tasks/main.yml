---

- name: "Clone wavm"
  git:
    repo: "git@github.com:Shillaker/WAVM.git"
    dest: "/usr/local/code/faasm/tools/WAVM"
    update: yes

- name: "Set up remote"
  shell: "git remote add upstream https://github.com/AndrewScheidecker/WAVM"
  args:
    chdir: "/usr/local/code/faasm/tools/WAVM"
  ignore_errors: yes

- name: "Create build directory"
  file:
    path: "/usr/local/code/faasm/tools/WAVM/build"
    state: directory
    mode: 0755

- name: "Build wavm"
  shell: "{{ item }}"
  args:
      chdir: "/usr/local/code/faasm/tools/WAVM/build"
  with_items:
    - "cmake -DCMAKE_BUILD_TYPE=Release .."
    - "cmake --build . --target all"
